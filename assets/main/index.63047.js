window.__require=function t(e,o,n){function i(s,c){if(!o[s]){if(!e[s]){var a=s.split("/");if(a=a[a.length-1],!e[a]){var u="function"==typeof __require&&__require;if(!c&&u)return u(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var l=o[s]={exports:{}};e[s][0].call(l.exports,function(t){return i(e[s][1][t]||t)},l,l.exports,t,e,o,n)}return o[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<n.length;s++)i(n[s]);return i}({BoardView:[function(t,e,o){"use strict";cc._RF.push(e,"b25cfRn/7lAQ5N5t5hVwOeS","BoardView");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function s(t){try{a(n.next(t))}catch(e){r(e)}}function c(t){try{a(n.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}a((n=n.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(t){return function(e){return a([t,e])}}function a(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(c){r=[6,c],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.DefaultAnimationController=void 0;var a=cc._decorator,u=a.ccclass,l=a.property,p=t("./GameEvents"),h=t("./TileView"),f=function(){function t(t){this._config=t}return t.prototype.playBurnAnimation=function(t){return s(this,void 0,Promise,function(){var e;return c(this,function(o){switch(o.label){case 0:return e=t.map(function(t){return t.playBurnAnimation()}),[4,Promise.all(e)];case 1:return o.sent(),[2]}})})},t.prototype.playDropAnimation=function(t,e){return s(this,void 0,Promise,function(){var o,n=this;return c(this,function(i){switch(i.label){case 0:return o=t.map(function(t,o){var i=e[o],r=n._getWorldPosition(i);return t.playDropAnimation(r)}),[4,Promise.all(o)];case 1:return i.sent(),[2]}})})},t.prototype.playRefillAnimation=function(t,e,o){return s(this,void 0,Promise,function(){var n,i=this;return c(this,function(r){switch(r.label){case 0:return n=t.map(function(t,n){var r=e[n],s=o[n],c=(i._getWorldPosition(r),i._getWorldPosition(s));return t.setPosition(r),t.playDropAnimation(c,i._config.refillDelay)}),[4,Promise.all(n)];case 1:return r.sent(),[2]}})})},t.prototype._getWorldPosition=function(t){var e=72*t.column,o=72*-t.row;return cc.v2(e,o)},t}();o.DefaultAnimationController=f;var _=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tilePrefab=null,e.gridParent=null,e.cellSize=72,e.refillDelay=.05,e._tiles=[],e}return i(e,t),e.prototype.onLoad=function(){this._setupEventListeners()},e.prototype.onDestroy=function(){this._removeEventListeners()},e.prototype.initialize=function(t,e){this._eventBus=t,this._config=e,this._animationController=new f({burnDuration:.18,dropDuration:.28,refillDelay:this.refillDelay})},e.prototype.setConfig=function(t){this._config=t},e.prototype.initializeFromSnapshot=function(t){this._clearGrid(),this._createTilesFromSnapshot(t)},e.prototype.animateBurnAndCollapse=function(t,e){return s(this,void 0,Promise,function(){var o,n,i,r,s,a,u,l,f,_,v,d,y,m;return c(this,function(c){switch(c.label){case 0:for(o=t.map(function(t){return{r:t.row,c:t.column}}),this._eventBus.publish(p.GameEvents.BOARD_ANIMATION_STARTED,{animationType:"burn",positions:t}),n=[],i=0,r=o;i<r.length;i++)s=r[i],(y=this._tiles[s.r][s.c])&&(n.push(y.playBurnAnimation()),this._tiles[s.r][s.c]=null);return[4,Promise.all(n)];case 1:for(c.sent(),a=[],f=0;f<this._config.columns;f++)for(u=this._config.rows-1,_=this._config.rows-1;_>=0;_--)(y=this._tiles[_][f])&&(u!==_&&(this._tiles[u][f]=y,this._tiles[_][f]=null,m=this.getWorldPosition(u,f),a.push(y.playDropAnimation(m)),y.gridR=u,y.gridC=f),u--);return[4,Promise.all(a)];case 2:for(c.sent(),l=[],f=0;f<this._config.columns;f++)for(_=this._config.rows-1;_>=0;_--)this._tiles[_][f]||((v=cc.instantiate(this.tilePrefab)).parent=this.gridParent,d=this.getWorldPosition(-1,f),v.setPosition(d),y=v.getComponent(h.default),this._eventBus&&y.initialize(this._eventBus),y.gridR=_,y.gridC=f,this._tiles[_][f]=y,y.setData(e[_][f]),m=this.getWorldPosition(_,f),l.push(y.playDropAnimation(m,.05*(this._config.rows-_))));return[4,Promise.all(l)];case 3:return c.sent(),this._eventBus.publish(p.GameEvents.BOARD_ANIMATION_COMPLETED,{animationType:"refill"}),[2]}})})},e.prototype.applySnapshot=function(t){for(var e=0;e<this._config.rows;e++)for(var o=0;o<this._config.columns;o++){var n=this._tiles[e][o];n&&n.setData(t[e][o])}},e.prototype.getTileViewAt=function(t){return this._isValidPosition(t)?this._tiles[t.row][t.column]:null},e.prototype._setupEventListeners=function(){this._eventBus&&this._eventBus.subscribe(p.GameEvents.TILE_CLICKED,this._onTileClicked.bind(this))},e.prototype._removeEventListeners=function(){this._eventBus&&this._eventBus.unsubscribe(p.GameEvents.TILE_CLICKED,this._onTileClicked.bind(this))},e.prototype._onTileClicked=function(t){this.node.emit("TileClicked",t.data)},e.prototype._clearGrid=function(){var t=this;this.gridParent?(this.gridParent.removeAllChildren(),this._tiles=Array.from({length:this._config.rows},function(){return Array.from({length:t._config.columns},function(){return null})})):console.error("GridParent is not assigned in BoardView!")},e.prototype._createTilesFromSnapshot=function(t){for(var e=0;e<this._config.rows;e++)for(var o=0;o<this._config.columns;o++){var n={row:e,column:o},i=this._createTileView(n);i?(i.setData(t[e][o]),this._tiles[e][o]=i):(console.error("Failed to create tile view at position "+e+", "+o),this._tiles[e][o]=null)}},e.prototype._createTileView=function(t){var e=cc.instantiate(this.tilePrefab);e.parent=this.gridParent;var o=e.getComponent(h.default);if(!o)return console.error("TileView component not found on tile prefab!"),null;this._eventBus&&o.initialize(this._eventBus),o.gridR=t.row,o.gridC=t.column;var n=this._getWorldPosition(t);return e.setPosition(n),o},e.prototype._getWorldPosition=function(t){var e=t.column*this.cellSize,o=-t.row*this.cellSize;return cc.v2(e,o)},e.prototype.getWorldPosition=function(t,e){var o=e*this.cellSize,n=-t*this.cellSize;return cc.v2(o,n)},e.prototype._isValidPosition=function(t){return t.row>=0&&t.row<this._config.rows&&t.column>=0&&t.column<this._config.columns},e.prototype._getTileViewsAtPositions=function(t){var e=this;return t.map(function(t){return e._tiles[t.row][t.column]}).filter(function(t){return null!==t})},e.prototype._clearTilesAtPositions=function(t){for(var e=0,o=t;e<o.length;e++){var n=o[e];this._isValidPosition(n)&&(this._tiles[n.row][n.column]=null)}},e.prototype._calculateDropPositions=function(){for(var t=[],e=[],o=0;o<this._config.columns;o++)for(var n=this._config.rows-1,i=this._config.rows-1;i>=0;i--){var r=this._tiles[i][o];r&&(n!==i&&(this._tiles[n][o]=r,this._tiles[i][o]=null,r.gridR=n,r.gridC=o,t.push(r),e.push({row:n,column:o})),n--)}return{tileViews:t,targetPositions:e}},e.prototype._calculateRefillPositions=function(t){for(var e=[],o=[],n=[],i=0;i<this._config.columns;i++)for(var r=this._config.rows-1;r>=0;r--)if(!this._tiles[r][i]&&t[r][i]){var s=this._createTileView({row:-1,column:i});s?(s.setData(t[r][i]),this._tiles[r][i]=s,e.push(s),o.push({row:-1,column:i}),n.push({row:r,column:i})):console.error("Failed to create tile view for refill at position "+r+", "+i)}return{tileViews:e,startPositions:o,targetPositions:n}},e.prototype.initFromSnapshot=function(t){this.initializeFromSnapshot(t)},Object.defineProperty(e.prototype,"rows",{get:function(){var t;return(null===(t=this._config)||void 0===t?void 0:t.rows)||8},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cols",{get:function(){var t;return(null===(t=this._config)||void 0===t?void 0:t.columns)||8},enumerable:!1,configurable:!0}),r([l(cc.Prefab)],e.prototype,"tilePrefab",void 0),r([l(cc.Node)],e.prototype,"gridParent",void 0),r([l(cc.Float)],e.prototype,"cellSize",void 0),r([l(cc.Float)],e.prototype,"refillDelay",void 0),r([u],e)}(cc.Component);o.default=_,cc._RF.pop()},{"./GameEvents":"GameEvents","./TileView":"TileView"}],EventBus:[function(t,e,o){"use strict";cc._RF.push(e,"517aciNQMtFbJx5y5kbf26U","EventBus"),Object.defineProperty(o,"__esModule",{value:!0}),o.gameEventBus=o.EventBus=void 0;var n=function(){function t(){this._listeners=new Map}return t.prototype.subscribe=function(t,e){this._listeners.has(t)||this._listeners.set(t,new Set),this._listeners.get(t).add(e)},t.prototype.unsubscribe=function(t,e){var o=this._listeners.get(t);o&&(o.delete(e),0===o.size&&this._listeners.delete(t))},t.prototype.publish=function(t,e){var o=this._listeners.get(t);if(o){var n={type:t,data:e,timestamp:Date.now()};o.forEach(function(e){try{e(n)}catch(o){console.error("Error in event listener for "+t+":",o)}})}},t.prototype.clear=function(){this._listeners.clear()},t}();o.EventBus=n,o.gameEventBus=new n,cc._RF.pop()},{}],GameBoard:[function(t,e,o){"use strict";cc._RF.push(e,"12ae9Yi8BZMkZzmCiWzFCI/","GameBoard");var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.GameBoard=void 0;var i=t("./GameEvents"),r=function(){function t(t,e,o){this._config=t,this._tileFactory=e,this._eventBus=o,this.grid=Array.from({length:t.rows},function(){return Array.from({length:t.columns},function(){return null})}),this.fillAll()}return t.prototype.getRows=function(){return this._config.rows},t.prototype.getColumns=function(){return this._config.columns},t.prototype.getTileAt=function(t){return this._isValidPosition(t)?this.grid[t.row][t.column]:null},t.prototype.tileAt=function(t){return this.grid[t.r][t.c]},t.prototype.findGroup=function(t){var e=this.tileAt(t);if(!e)return[];for(var o=e.colorIndex,n=new Set,i=[t],r=[],s=function(t){return t.r+","+t.c};i.length;){var c=i.pop();if(!n.has(s(c))){n.add(s(c));var a=this.tileAt(c);if(a&&a.colorIndex===o){r.push(c);for(var u=0,l=[{r:c.r-1,c:c.c},{r:c.r+1,c:c.c},{r:c.r,c:c.c-1},{r:c.r,c:c.c+1}];u<l.length;u++){var p=l[u];p.r<0||p.r>=this._config.rows||p.c<0||p.c>=this._config.columns||n.has(s(p))||i.push(p)}}}}return r},t.prototype.findMatchingGroup=function(t){var e={r:t.row,c:t.column};return this.findGroup(e).map(function(t){return{row:t.r,column:t.c}})},t.prototype.removeTiles=function(t){if(0!==t.length){for(var e=0,o=t;e<o.length;e++){var n=o[e];this._isValidPosition(n)&&(this.grid[n.row][n.column]=null)}this.applyGravity(),this.refillTop(),this._eventBus.publish(i.GameEvents.BOARD_UPDATED,{removedPositions:t})}},t.prototype.removePositions=function(t){for(var e=0,o=t;e<o.length;e++){var n=o[e];this.grid[n.r][n.c]=null}this.applyGravity(),this.refillTop()},t.prototype.hasValidMoves=function(){for(var t=new Set,e=function(t){return t.r+","+t.c},o=0;o<this._config.rows;o++)for(var n=0;n<this._config.columns;n++){var i={r:o,c:n};if(!t.has(e(i))&&this.tileAt(i)){for(var r=this.findGroup(i),s=0,c=r;s<c.length;s++){var a=c[s];t.add(e(a))}if(r.length>=2)return!0}}return!1},t.prototype.anyMovesExist=function(){return this.hasValidMoves()},t.prototype.getSnapshot=function(){return this.grid.map(function(t){return t.map(function(t){return t?n({},t):null})})},t.prototype.snapshot=function(){return this.grid.map(function(t){return t.map(function(t){return t?n({},t):null})})},t.prototype.initialize=function(){this.fillAll()},t.prototype.fillAll=function(){for(var t=0;t<this._config.rows;t++)for(var e=0;e<this._config.columns;e++)this.grid[t][e]=this._tileFactory.next()},t.prototype._isValidPosition=function(t){return t.row>=0&&t.row<this._config.rows&&t.column>=0&&t.column<this._config.columns},t.prototype.applyGravity=function(){for(var t=0;t<this._config.columns;t++)for(var e=this._config.rows-1,o=this._config.rows-1;o>=0;o--)this.grid[o][t]&&(e!==o&&(this.grid[e][t]=this.grid[o][t],this.grid[o][t]=null),e--)},t.prototype.refillTop=function(){for(var t=0;t<this._config.columns;t++)for(var e=0;e<this._config.rows;e++)this.grid[e][t]||(this.grid[e][t]=this._tileFactory.next())},t.prototype.getCols=function(){return this.getColumns()},t}();o.GameBoard=r,cc._RF.pop()},{"./GameEvents":"GameEvents"}],GameController:[function(t,e,o){"use strict";cc._RF.push(e,"adc98hbUD9HPZL7X0r45uxe","GameController");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s},s=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function s(t){try{a(n.next(t))}catch(e){r(e)}}function c(t){try{a(n.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}a((n=n.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(t){return function(e){return a([t,e])}}function a(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(c){r=[6,c],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,u=a.ccclass,l=a.property,p=t("./EventBus"),h=t("./InputLock"),f=t("./GameBoard"),_=t("./GameService"),v=t("./UIService"),d=t("./TileFactory"),y=t("./ScoringStrategy"),m=t("./GameEvents"),g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boardView=null,e.scoreLabel=null,e.movesLabel=null,e.popup=null,e.popupMessage=null,e.rows=8,e.cols=8,e.moves=20,e.targetScore=500,e.colorCount=5,e}return i(e,t),e.prototype.onLoad=function(){this._initializeServices(),this._setupEventListeners(),this._startGame()},e.prototype.onDestroy=function(){this._cleanupEventListeners()},e.prototype._initializeServices=function(){this._eventBus=p.gameEventBus,h.initializeInputManager(this._eventBus),this._gameConfig=this._createGameConfig(),this._board=this._createGameBoard(),this._gameService=this._createGameService(),this._uiService=this._createUIService(),this._initializeBoardView()},e.prototype._createGameConfig=function(){return{board:{rows:this.rows,columns:this.cols,cellSize:72,colorCount:this.colorCount},scoring:{baseScore:10,multiplier:2,targetScore:this.targetScore},ui:{moves:this.moves,animationDuration:.3}}},e.prototype._createGameBoard=function(){var t=d.TileFactoryFactory.createRandomFactory(this._gameConfig.board);return new f.GameBoard(this._gameConfig.board,t,this._eventBus)},e.prototype._createGameService=function(){var t=y.ScoringStrategyFactory.createDefault(this._gameConfig.scoring);return new _.GameService(this._board,t,this._eventBus,this._gameConfig)},e.prototype._createUIService=function(){return new v.UIService(this._eventBus,this.scoreLabel,this.movesLabel,this.popup,this.popupMessage)},e.prototype._initializeBoardView=function(){this.boardView&&this.boardView.initialize(this._eventBus,this._gameConfig.board)},e.prototype._setupEventListeners=function(){this._eventBus.subscribe(m.GameEvents.TILE_CLICKED,this._onTileClicked.bind(this)),this._eventBus.subscribe(m.GameEvents.BOARD_ANIMATION_STARTED,this._onAnimationStarted.bind(this)),this._eventBus.subscribe(m.GameEvents.BOARD_ANIMATION_COMPLETED,this._onAnimationCompleted.bind(this))},e.prototype._cleanupEventListeners=function(){this._eventBus.unsubscribe(m.GameEvents.TILE_CLICKED,this._onTileClicked.bind(this)),this._eventBus.unsubscribe(m.GameEvents.BOARD_ANIMATION_STARTED,this._onAnimationStarted.bind(this)),this._eventBus.unsubscribe(m.GameEvents.BOARD_ANIMATION_COMPLETED,this._onAnimationCompleted.bind(this))},e.prototype._startGame=function(){this._board.initialize(),this.boardView?this.boardView.initializeFromSnapshot(this._board.getSnapshot()):console.error("BoardView is not assigned!"),this._eventBus.publish(m.GameEvents.GAME_STARTED,{})},e.prototype._onTileClicked=function(t){return s(this,void 0,Promise,function(){var e,o,n;return c(this,function(i){switch(i.label){case 0:if((e=h.getInputManager()).isLocked())return[2];e.lock(),i.label=1;case 1:return i.trys.push([1,,5,6]),o=t.data,n=this._board.findMatchingGroup(o.position),[4,this._gameService.processTileClick(o.position)];case 2:return i.sent()&&this.boardView?[4,this.boardView.animateBurnAndCollapse(n,this._board.getSnapshot())]:[3,4];case 3:i.sent(),i.label=4;case 4:return[3,6];case 5:return e.unlock(),[7];case 6:return[2]}})})},e.prototype._onAnimationStarted=function(){h.getInputManager().lock()},e.prototype._onAnimationCompleted=function(){h.getInputManager().unlock()},e.prototype.onRestartButton=function(){this._gameService.restart(),this.boardView&&this.boardView.initializeFromSnapshot(this._board.getSnapshot())},r([l(cc.Component)],e.prototype,"boardView",void 0),r([l(cc.Label)],e.prototype,"scoreLabel",void 0),r([l(cc.Label)],e.prototype,"movesLabel",void 0),r([l(cc.Node)],e.prototype,"popup",void 0),r([l(cc.Label)],e.prototype,"popupMessage",void 0),r([l(cc.Integer)],e.prototype,"rows",void 0),r([l(cc.Integer)],e.prototype,"cols",void 0),r([l(cc.Integer)],e.prototype,"moves",void 0),r([l(cc.Integer)],e.prototype,"targetScore",void 0),r([l(cc.Integer)],e.prototype,"colorCount",void 0),r([u],e)}(cc.Component);o.default=g,cc._RF.pop()},{"./EventBus":"EventBus","./GameBoard":"GameBoard","./GameEvents":"GameEvents","./GameService":"GameService","./InputLock":"InputLock","./ScoringStrategy":"ScoringStrategy","./TileFactory":"TileFactory","./UIService":"UIService"}],GameEvents:[function(t,e,o){"use strict";cc._RF.push(e,"7de92ND7txDrKBh9lNR/y7C","GameEvents"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameEvents=void 0;var n=function(){function t(){}return t.GAME_STARTED="game:started",t.GAME_ENDED="game:ended",t.GAME_WON="game:won",t.GAME_LOST="game:lost",t.GAME_RESTARTED="game:restarted",t.TILE_CLICKED="board:tile_clicked",t.TILES_MATCHED="board:tiles_matched",t.BOARD_UPDATED="board:updated",t.BOARD_ANIMATION_STARTED="board:animation_started",t.BOARD_ANIMATION_COMPLETED="board:animation_completed",t.SCORE_UPDATED="ui:score_updated",t.MOVES_UPDATED="ui:moves_updated",t.UI_UPDATED="ui:updated",t.INPUT_LOCKED="input:locked",t.INPUT_UNLOCKED="input:unlocked",t}();o.GameEvents=n,cc._RF.pop()},{}],GameService:[function(t,e,o){"use strict";cc._RF.push(e,"06d50xzjLdPa6NgJUsBUOs6","GameService");var n=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,r){function s(t){try{a(n.next(t))}catch(e){r(e)}}function c(t){try{a(n.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(s,c)}a((n=n.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(t){return function(e){return a([t,e])}}function a(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(c){r=[6,c],n=0}finally{o=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.GameService=void 0;var r=t("./GameEvents"),s=function(){function t(t,e,o,n){this._board=t,this._scoringStrategy=e,this._eventBus=o,this._config=n,this._score=0,this._movesLeft=0,this._isGameOver=!1,this._isWon=!1,this._movesLeft=this._config.ui.moves,this._setupEventListeners()}return t.prototype.getCurrentState=function(){return{score:this._score,movesLeft:this._movesLeft,isGameOver:this._isGameOver,isWon:this._isWon}},t.prototype.processTileClick=function(t){return n(this,void 0,Promise,function(){var e,o;return i(this,function(){return this._isGameOver||this._movesLeft<=0?[2,!1]:(e=this._board.findMatchingGroup(t)).length<2?[2,!1]:(o=this._scoringStrategy.getTotalScore(e.length),this._score+=o,this._movesLeft--,this._board.removeTiles(e),this._eventBus.publish(r.GameEvents.TILES_MATCHED,{positions:e,score:o}),this._updateGameState(),[2,!0])})})},t.prototype.restart=function(){this._score=0,this._movesLeft=this._config.ui.moves,this._isGameOver=!1,this._isWon=!1,this._board.initialize(),this._eventBus.publish(r.GameEvents.GAME_RESTARTED,{})},t.prototype.isGameOver=function(){return this._isGameOver},t.prototype.isWon=function(){return this._isWon},t.prototype._setupEventListeners=function(){this._eventBus.subscribe(r.GameEvents.BOARD_UPDATED,this._onBoardUpdated.bind(this))},t.prototype._onBoardUpdated=function(){this._checkGameConditions()},t.prototype._checkGameConditions=function(){this._score>=this._config.scoring.targetScore?(this._isWon=!0,this._isGameOver=!0,this._eventBus.publish(r.GameEvents.GAME_WON,{})):(this._movesLeft<=0||!this._board.hasValidMoves())&&(this._isGameOver=!0,this._eventBus.publish(r.GameEvents.GAME_LOST,{}))},t.prototype._updateGameState=function(){this._eventBus.publish(r.GameEvents.SCORE_UPDATED,{score:this._score}),this._eventBus.publish(r.GameEvents.MOVES_UPDATED,{movesLeft:this._movesLeft});var t=this.getCurrentState();this._eventBus.publish(r.GameEvents.UI_UPDATED,{state:t})},t}();o.GameService=s,cc._RF.pop()},{"./GameEvents":"GameEvents"}],IAnimationController:[function(t,e,o){"use strict";cc._RF.push(e,"5793dSh7ZZGTrJgzEG46ZWy","IAnimationController"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IBoardView:[function(t,e,o){"use strict";cc._RF.push(e,"87495rwy+BGk7xkGfF6TuiA","IBoardView"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IEventBus:[function(t,e,o){"use strict";cc._RF.push(e,"771cdgpaMFCKLs55P2qZF7d","IEventBus"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IGameBoard:[function(t,e,o){"use strict";cc._RF.push(e,"10157hT9P5IerG2IIAw0xDx","IGameBoard"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IGameService:[function(t,e,o){"use strict";cc._RF.push(e,"b9acaXl/2pGW6L+/yfXSByd","IGameService"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IInputManager:[function(t,e,o){"use strict";cc._RF.push(e,"3c4ee57da9IZpILu3DT5e/P","IInputManager"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IScoringStrategy:[function(t,e,o){"use strict";cc._RF.push(e,"c9cf5burb5HWo8FUqjrL0s4","IScoringStrategy"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ITileFactory:[function(t,e,o){"use strict";cc._RF.push(e,"3864a7ecyxK87t8uD2Wt8Oz","ITileFactory"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],ITileView:[function(t,e,o){"use strict";cc._RF.push(e,"1455bci65VGOoNCDLU2L0N3","ITileView"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],IUIService:[function(t,e,o){"use strict";cc._RF.push(e,"c6409qgoj1GnpJRH7L2Kcz3","IUIService"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],InputLock:[function(t,e,o){"use strict";cc._RF.push(e,"82c19nb335EbJefEJlGIsqa","InputLock"),Object.defineProperty(o,"__esModule",{value:!0}),o.getInputManager=o.initializeInputManager=o.InputManager=void 0;var n=t("./GameEvents"),i=function(){function t(t){this._eventBus=t,this._locked=!1}return t.prototype.lock=function(){this._locked||(this._locked=!0,this._eventBus.publish(n.GameEvents.INPUT_LOCKED,{}))},t.prototype.unlock=function(){this._locked&&(this._locked=!1,this._eventBus.publish(n.GameEvents.INPUT_UNLOCKED,{}))},t.prototype.isLocked=function(){return this._locked},t}();o.InputManager=i;var r=null;function s(){if(!r)throw new Error("InputManager not initialized. Call initializeInputManager first.");return r}o.initializeInputManager=function(t){r=new i(t)},o.getInputManager=s;var c=function(){function t(){}return t.lock=function(){s().lock()},t.unlock=function(){s().unlock()},Object.defineProperty(t,"isLocked",{get:function(){return s().isLocked()},enumerable:!1,configurable:!0}),t}();o.default=c,cc._RF.pop()},{"./GameEvents":"GameEvents"}],ScoringStrategy:[function(t,e,o){"use strict";cc._RF.push(e,"e9daaHCR5dJ1rYMoAxaFGE1","ScoringStrategy"),Object.defineProperty(o,"__esModule",{value:!0}),o.ScoringStrategyFactory=o.ExponentialScoringStrategy=o.LinearScoringStrategy=o.DefaultScoringStrategy=void 0;var n=function(){function t(t){this._config=t}return t.prototype.calculateScore=function(t){return t<2?0:this._config.baseScore*(t-1)},t.prototype.calculateBonusScore=function(t){if(t<3)return 0;var e=Math.floor((t-2)/2);return this._config.baseScore*e*this._config.multiplier},t.prototype.getTotalScore=function(t){return this.calculateScore(t)+this.calculateBonusScore(t)},t}();o.DefaultScoringStrategy=n;var i=function(){function t(t){this._config=t}return t.prototype.calculateScore=function(t){return t<2?0:this._config.baseScore*t},t.prototype.calculateBonusScore=function(){return 0},t.prototype.getTotalScore=function(t){return this.calculateScore(t)},t}();o.LinearScoringStrategy=i;var r=function(){function t(t){this._config=t}return t.prototype.calculateScore=function(t){return t<2?0:this._config.baseScore*Math.pow(t,this._config.multiplier)},t.prototype.calculateBonusScore=function(){return 0},t.prototype.getTotalScore=function(t){return this.calculateScore(t)},t}();o.ExponentialScoringStrategy=r;var s=function(){function t(){}return t.createDefault=function(t){return new n(t)},t.createLinear=function(t){return new i(t)},t.createExponential=function(t){return new r(t)},t}();o.ScoringStrategyFactory=s,cc._RF.pop()},{}],TileFactory:[function(t,e,o){"use strict";cc._RF.push(e,"50a53Qo0ztFeK4mEmkcoW/U","TileFactory"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileFactoryFactory=o.TileFactory=o.RandomTileGenerator=void 0;var n=function(){function t(t){if(this._colorCount=t,t<=0)throw new Error("Color count must be greater than 0")}return t.prototype.generateColorIndex=function(){return Math.floor(Math.random()*this._colorCount)},t}();o.RandomTileGenerator=n;var i=function(){function t(t,e){this._generator=t,this._config=e,this._nextId=1}return t.prototype.next=function(){var t=this._generator.generateColorIndex();return{id:this._nextId++,colorIndex:t}},t.prototype.createTile=function(){return this.next()},t.prototype.createTiles=function(t){if(t<=0)throw new Error("Count must be greater than 0");for(var e=[],o=0;o<t;o++)e.push(this.next());return e},t}();o.TileFactory=i;var r=function(){function t(){}return t.createRandomFactory=function(t){var e=new n(t.colorCount);return new i(e,t)},t}();o.TileFactoryFactory=r,cc._RF.pop()},{}],TileView:[function(t,e,o){"use strict";cc._RF.push(e,"573657nM0tIwJva4Nqfq/pX","TileView");var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(r<3?i(s):r>3?i(e,o,s):i(e,o))||s);return r>3&&s&&Object.defineProperty(e,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,a=s.property,u=t("./GameEvents"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e.label=null,e.tileSprites=[],e.burnDuration=.18,e.dropDuration=.28,e.gridR=0,e.gridC=0,e._tileData=null,e}return i(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTileClicked,this)},e.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.TOUCH_END,this._onTileClicked,this)},e.prototype.initialize=function(t){this._eventBus=t},e.prototype._onTileClicked=function(){if(this._eventBus){var t={position:this.getPosition()};this._eventBus.publish(u.GameEvents.TILE_CLICKED,t)}},e.prototype.setData=function(t){this._tileData=t,t?(this.setActive(!0),this._updateVisuals(t)):this.setActive(!1)},e.prototype._updateVisuals=function(t){this.tileSprites&&this.tileSprites[t.colorIndex]?(this.sprite&&(this.sprite.spriteFrame=this.tileSprites[t.colorIndex]),this.label&&(this.label.string="")):this.label&&(this.label.string=String(t.colorIndex))},e.prototype.playBurnAnimation=function(){var t=this;return new Promise(function(e){var o=cc.fadeOut(t.burnDuration),n=cc.scaleTo(t.burnDuration,0),i=cc.sequence(cc.spawn(o,n),cc.callFunc(function(){t._resetVisualState(),e()}));t.node.runAction(i)})},e.prototype.playDropAnimation=function(t,e){var o=this;return void 0===e&&(e=0),new Promise(function(n){var i=cc.moveTo(o.dropDuration,t).easing(cc.easeCubicActionOut()),r=cc.sequence(cc.delayTime(e),i,cc.callFunc(function(){return n()}));o.node.runAction(r)})},e.prototype.getPosition=function(){return{row:this.gridR,column:this.gridC}},e.prototype.setPosition=function(t){this.gridR=t.row,this.gridC=t.column},e.prototype.isActive=function(){return this.node.active},e.prototype.setActive=function(t){this.node.active=t},e.prototype._resetVisualState=function(){this.node.active=!1,this.node.setScale(1),this.node.opacity=255},Object.defineProperty(e.prototype,"tileData",{get:function(){return this._tileData},enumerable:!1,configurable:!0}),r([a(cc.Sprite)],e.prototype,"sprite",void 0),r([a(cc.Label)],e.prototype,"label",void 0),r([a([cc.SpriteFrame])],e.prototype,"tileSprites",void 0),r([a(cc.Float)],e.prototype,"burnDuration",void 0),r([a(cc.Float)],e.prototype,"dropDuration",void 0),r([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{"./GameEvents":"GameEvents"}],UIService:[function(t,e,o){"use strict";cc._RF.push(e,"918323wIfpFSaN9zjflhrPv","UIService"),Object.defineProperty(o,"__esModule",{value:!0}),o.UIService=void 0;var n=t("./GameEvents"),i=function(){function t(t,e,o,n,i){this._eventBus=t,this._scoreLabel=e,this._movesLabel=o,this._popup=n,this._popupMessage=i,this._setupEventListeners()}return t.prototype.updateScore=function(t){this._scoreLabel&&(this._scoreLabel.string="Score: "+t)},t.prototype.updateMoves=function(t){this._movesLabel&&(this._movesLabel.string="Moves: "+t)},t.prototype.updateGameState=function(t){this.updateScore(t.score),this.updateMoves(t.movesLeft)},t.prototype.showGameOverMessage=function(t){this._popup&&(this._popup.active=!0,this._popupMessage&&(this._popupMessage.string=t))},t.prototype.hideGameOverMessage=function(){this._popup&&(this._popup.active=!1)},t.prototype._setupEventListeners=function(){var t=this;this._eventBus.subscribe(n.GameEvents.SCORE_UPDATED,function(e){t.updateScore(e.data.score)}),this._eventBus.subscribe(n.GameEvents.MOVES_UPDATED,function(e){t.updateMoves(e.data.movesLeft)}),this._eventBus.subscribe(n.GameEvents.UI_UPDATED,function(e){t.updateGameState(e.data.state)}),this._eventBus.subscribe(n.GameEvents.GAME_WON,function(){t.showGameOverMessage("You Win!")}),this._eventBus.subscribe(n.GameEvents.GAME_LOST,function(){t.showGameOverMessage("Game Over")}),this._eventBus.subscribe(n.GameEvents.GAME_RESTARTED,function(){t.hideGameOverMessage()})},t}();o.UIService=i,cc._RF.pop()},{"./GameEvents":"GameEvents"}],types:[function(t,e,o){"use strict";cc._RF.push(e,"a0243BKjLpGHbT9eUPGrYNv","types"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}]},{},["BoardView","EventBus","GameBoard","GameController","GameEvents","GameService","InputLock","ScoringStrategy","TileFactory","TileView","UIService","IAnimationController","IBoardView","IEventBus","IGameBoard","IGameService","IInputManager","IScoringStrategy","ITileFactory","ITileView","IUIService","types"]);