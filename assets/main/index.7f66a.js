window.__require=function t(e,i,o){function n(s,c){if(!i[s]){if(!e[s]){var a=s.split("/");if(a=a[a.length-1],!e[a]){var u="function"==typeof __require&&__require;if(!c&&u)return u(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+s+"'")}s=a}var l=i[s]={exports:{}};e[s][0].call(l.exports,function(t){return n(e[s][1][t]||t)},l,l.exports,t,e,i,o)}return i[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<o.length;s++)n(o[s]);return n}({BoardPresenter:[function(t,e,i){"use strict";cc._RF.push(e,"c00e10eoUhHKbCkktkjHO0b","BoardPresenter");var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(n,r){function s(t){try{a(o.next(t))}catch(e){r(e)}}function c(t){try{a(o.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(s,c)}a((o=o.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(t){return function(e){return a([t,e])}}function a(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(c){r=[6,c],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0}),i.BoardPresenter=void 0;var r=t("./GameEvents"),s=function(){function t(){this._isAnimating=!1}return t.prototype.initialize=function(t,e,i,o,n){this._view=t,this._board=e,this._gameModel=n,this._eventBus=i,this._config=o,this._setupEventListeners(),this._initializeView()},t.prototype.onTileClicked=function(t){return o(this,void 0,Promise,function(){var e,i;return n(this,function(o){switch(o.label){case 0:if(this._isAnimating)return[2];if((e=this._board.findMatchingGroup(t)).length<2)return[2];if(this._gameModel.isGameOver()||!(this._gameModel.getCurrentState().movesLeft>0))return[2];this._isAnimating=!0,this._eventBus.publish(r.GameEvents.BOARD_ANIMATION_STARTED,{animationType:"burn",positions:e}),o.label=1;case 1:return o.trys.push([1,,4,5]),[4,this._gameModel.processTileMatch(e)];case 2:return o.sent(),i=this._board.getSnapshot(),[4,this._view.animateBurnAndCollapse(e,i)];case 3:return o.sent(),this._eventBus.publish(r.GameEvents.BOARD_ANIMATION_COMPLETED,{animationType:"refill"}),[3,5];case 4:return this._isAnimating=!1,[7];case 5:return[2]}})})},t.prototype.onBoardUpdated=function(t){return o(this,void 0,Promise,function(){return n(this,function(){return this._isAnimating?[2]:(this._view.applySnapshot(t),[2])})})},t.prototype.onTilesMatched=function(){return o(this,void 0,Promise,function(){return n(this,function(){return[2]})})},t.prototype.destroy=function(){this._removeEventListeners()},t.prototype._setupEventListeners=function(){this._eventBus.subscribe(r.GameEvents.TILE_CLICKED,this._onTileClicked.bind(this)),this._eventBus.subscribe(r.GameEvents.BOARD_UPDATED,this._onBoardUpdated.bind(this)),this._eventBus.subscribe(r.GameEvents.TILES_MATCHED,this._onTilesMatched.bind(this))},t.prototype._removeEventListeners=function(){this._eventBus.unsubscribe(r.GameEvents.TILE_CLICKED,this._onTileClicked.bind(this)),this._eventBus.unsubscribe(r.GameEvents.BOARD_UPDATED,this._onBoardUpdated.bind(this)),this._eventBus.unsubscribe(r.GameEvents.TILES_MATCHED,this._onTilesMatched.bind(this))},t.prototype._initializeView=function(){this._view.setConfig(this._config),this._view.initializeFromSnapshot(this._board.getSnapshot())},t.prototype._onTileClicked=function(t){return o(this,void 0,Promise,function(){var e;return n(this,function(i){switch(i.label){case 0:return e=t.data.position,[4,this.onTileClicked(e)];case 1:return i.sent(),[2]}})})},t.prototype._onBoardUpdated=function(){return o(this,void 0,Promise,function(){var t;return n(this,function(e){switch(e.label){case 0:return t=this._board.getSnapshot(),[4,this.onBoardUpdated(t)];case 1:return e.sent(),[2]}})})},t.prototype._onTilesMatched=function(t){return o(this,void 0,Promise,function(){var e;return n(this,function(i){switch(i.label){case 0:return e=t.data.positions,[4,this.onTilesMatched(e)];case 1:return i.sent(),[2]}})})},t}();i.BoardPresenter=s,cc._RF.pop()},{"./GameEvents":"GameEvents"}],BoardView:[function(t,e,i){"use strict";cc._RF.push(e,"b25cfRn/7lAQ5N5t5hVwOeS","BoardView");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},s=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(n,r){function s(t){try{a(o.next(t))}catch(e){r(e)}}function c(t){try{a(o.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(s,c)}a((o=o.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(t){return function(e){return a([t,e])}}function a(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(c){r=[6,c],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0}),i.DefaultAnimationController=void 0;var a=cc._decorator,u=a.ccclass,l=a.property,p=t("./TileView"),h=function(){function t(t,e){this._config=t,this._cellSize=e}return t.prototype.playBurnAnimation=function(t){return s(this,void 0,Promise,function(){var e;return c(this,function(i){switch(i.label){case 0:return e=t.map(function(t){return t.playBurnAnimation()}),[4,Promise.all(e)];case 1:return i.sent(),[2]}})})},t.prototype.playDropAnimation=function(t,e){return s(this,void 0,Promise,function(){var i,o=this;return c(this,function(n){switch(n.label){case 0:return i=t.map(function(t,i){var n=e[i],r=o._getWorldPosition(n);return t.playDropAnimation(r)}),[4,Promise.all(i)];case 1:return n.sent(),[2]}})})},t.prototype.playRefillAnimation=function(t,e,i){return s(this,void 0,Promise,function(){var o,n=this;return c(this,function(r){switch(r.label){case 0:return o=t.map(function(t,o){var r=e[o],s=i[o],c=n._getWorldPosition(r),a=n._getWorldPosition(s);t.setVisualPosition(c);var u=s.row*n._config.refillDelay;return t.playDropAnimation(a,u)}),[4,Promise.all(o)];case 1:return r.sent(),[2]}})})},t.prototype._getWorldPosition=function(t){var e=t.column*this._cellSize,i=-t.row*this._cellSize;return cc.v2(e,i)},t}();i.DefaultAnimationController=h;var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tilePrefab=null,e.gridParent=null,e._tiles=[],e}return n(e,t),e.prototype.onLoad=function(){this._setupEventListeners()},e.prototype.onDestroy=function(){this._removeEventListeners()},e.prototype.initialize=function(t,e){this._eventBus=t,this._config=e,this._animationController=new h({burnDuration:.18,dropDuration:.28,refillDelay:this._config.refillDelay},this._config.cellSize)},e.prototype.setConfig=function(t){this._config=t},e.prototype.initializeFromSnapshot=function(t){this._clearGrid(),this._createTilesFromSnapshot(t)},e.prototype.animateBurnAndCollapse=function(t,e){return s(this,void 0,Promise,function(){var i,o,n,r,s,a,u,l;return c(this,function(c){switch(c.label){case 0:return i=this._getTileViewsAtPositions(t),[4,this._animationController.playBurnAnimation(i)];case 1:return c.sent(),this._clearTilesAtPositions(t),o=this._calculateDropPositions(),n=o.tileViews,r=o.targetPositions,[4,this._animationController.playDropAnimation(n,r)];case 2:return c.sent(),s=this._calculateRefillPositions(e),a=s.tileViews,u=s.startPositions,l=s.targetPositions,[4,this._animationController.playRefillAnimation(a,u,l)];case 3:return c.sent(),[2]}})})},e.prototype.applySnapshot=function(t){for(var e=0;e<this._config.rows;e++)for(var i=0;i<this._config.columns;i++){var o=this._tiles[e][i];o&&o.setData(t[e][i])}},e.prototype.getTileViewAt=function(t){return this._isValidPosition(t)?this._tiles[t.row][t.column]:null},e.prototype._setupEventListeners=function(){},e.prototype._removeEventListeners=function(){},e.prototype._clearGrid=function(){var t=this;this.gridParent?(this.gridParent.removeAllChildren(),this._tiles=Array.from({length:this._config.rows},function(){return Array.from({length:t._config.columns},function(){return null})})):console.error("GridParent is not assigned in BoardView!")},e.prototype._createTilesFromSnapshot=function(t){for(var e=0;e<this._config.rows;e++)for(var i=0;i<this._config.columns;i++){var o={row:e,column:i},n=this._createTileView(o);n?(n.setData(t[e][i]),this._tiles[e][i]=n):(console.error("Failed to create tile view at position "+e+", "+i),this._tiles[e][i]=null)}},e.prototype._createTileView=function(t){var e=cc.instantiate(this.tilePrefab);e.parent=this.gridParent;var i=e.getComponent(p.default);if(!i)return console.error("TileView component not found on tile prefab!"),null;this._eventBus&&i.initialize(this._eventBus),i.gridR=t.row,i.gridC=t.column;var o=this._getWorldPosition(t);return e.setPosition(o),i},e.prototype._getWorldPosition=function(t){var e=t.column*this._config.cellSize,i=-t.row*this._config.cellSize;return cc.v2(e,i)},e.prototype._isValidPosition=function(t){return t.row>=0&&t.row<this._config.rows&&t.column>=0&&t.column<this._config.columns},e.prototype._getTileViewsAtPositions=function(t){var e=this;return t.map(function(t){return e._tiles[t.row][t.column]}).filter(function(t){return null!==t})},e.prototype._clearTilesAtPositions=function(t){for(var e=0,i=t;e<i.length;e++){var o=i[e];this._isValidPosition(o)&&(this._tiles[o.row][o.column]=null)}},e.prototype._calculateDropPositions=function(){for(var t=[],e=[],i=0;i<this._config.columns;i++)for(var o=this._config.rows-1,n=this._config.rows-1;n>=0;n--){var r=this._tiles[n][i];r&&(o!==n&&(this._tiles[o][i]=r,this._tiles[n][i]=null,r.gridR=o,r.gridC=i,t.push(r),e.push({row:o,column:i})),o--)}return{tileViews:t,targetPositions:e}},e.prototype._calculateRefillPositions=function(t){for(var e=[],i=[],o=[],n=0;n<this._config.columns;n++)for(var r=this._config.rows-1;r>=0;r--)if(!this._tiles[r][n]&&t[r][n]){var s=this._createTileView({row:r,column:n});s?(s.setData(t[r][n]),this._tiles[r][n]=s,e.push(s),i.push({row:-1-(this._config.rows-1-r),column:n}),o.push({row:r,column:n})):console.error("Failed to create tile view for refill at position "+r+", "+n)}return{tileViews:e,startPositions:i,targetPositions:o}},r([l(cc.Prefab)],e.prototype,"tilePrefab",void 0),r([l(cc.Node)],e.prototype,"gridParent",void 0),r([u],e)}(cc.Component);i.default=f,cc._RF.pop()},{"./TileView":"TileView"}],EventBus:[function(t,e,i){"use strict";cc._RF.push(e,"517aciNQMtFbJx5y5kbf26U","EventBus"),Object.defineProperty(i,"__esModule",{value:!0}),i.gameEventBus=i.EventBus=void 0;var o=function(){function t(){this._listeners=new Map}return t.prototype.subscribe=function(t,e){this._listeners.has(t)||this._listeners.set(t,new Set),this._listeners.get(t).add(e)},t.prototype.unsubscribe=function(t,e){var i=this._listeners.get(t);i&&(i.delete(e),0===i.size&&this._listeners.delete(t))},t.prototype.publish=function(t,e){var i=this._listeners.get(t);if(i){var o={type:t,data:e,timestamp:Date.now()};i.forEach(function(e){try{e(o)}catch(i){console.error("Error in event listener for "+t+":",i)}})}},t.prototype.clear=function(){this._listeners.clear()},t}();i.EventBus=o,i.gameEventBus=new o,cc._RF.pop()},{}],GameBoard:[function(t,e,i){"use strict";cc._RF.push(e,"12ae9Yi8BZMkZzmCiWzFCI/","GameBoard");var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};Object.defineProperty(i,"__esModule",{value:!0}),i.GameBoard=void 0;var n=t("./GameEvents"),r=function(){function t(t,e,i){this._config=t,this._tileFactory=e,this._eventBus=i,this.grid=Array.from({length:t.rows},function(){return Array.from({length:t.columns},function(){return null})}),this.fillAll()}return t.prototype.getRows=function(){return this._config.rows},t.prototype.getColumns=function(){return this._config.columns},t.prototype.getTileAt=function(t){return this._isValidPosition(t)?this.grid[t.row][t.column]:null},t.prototype.tileAt=function(t){return this.grid[t.r][t.c]},t.prototype.findGroup=function(t){var e=this.tileAt(t);if(!e)return[];for(var i=e.colorIndex,o=new Set,n=[t],r=[],s=function(t){return t.r+","+t.c};n.length;){var c=n.pop();if(!o.has(s(c))){o.add(s(c));var a=this.tileAt(c);if(a&&a.colorIndex===i){r.push(c);for(var u=0,l=[{r:c.r-1,c:c.c},{r:c.r+1,c:c.c},{r:c.r,c:c.c-1},{r:c.r,c:c.c+1}];u<l.length;u++){var p=l[u];p.r<0||p.r>=this._config.rows||p.c<0||p.c>=this._config.columns||o.has(s(p))||n.push(p)}}}}return r},t.prototype.findMatchingGroup=function(t){var e={r:t.row,c:t.column};return this.findGroup(e).map(function(t){return{row:t.r,column:t.c}})},t.prototype.removeTiles=function(t){if(0!==t.length){for(var e=0,i=t;e<i.length;e++){var o=i[e];this._isValidPosition(o)&&(this.grid[o.row][o.column]=null)}this.applyGravity(),this.refillTop(),this._eventBus.publish(n.GameEvents.BOARD_UPDATED,{removedPositions:t})}},t.prototype.hasValidMoves=function(){for(var t=new Set,e=function(t){return t.r+","+t.c},i=0;i<this._config.rows;i++)for(var o=0;o<this._config.columns;o++){var n={r:i,c:o};if(!t.has(e(n))&&this.tileAt(n)){for(var r=this.findGroup(n),s=0,c=r;s<c.length;s++){var a=c[s];t.add(e(a))}if(r.length>=2)return!0}}return!1},t.prototype.getSnapshot=function(){return this.grid.map(function(t){return t.map(function(t){return t?o({},t):null})})},t.prototype.initialize=function(){this.fillAll()},t.prototype.fillAll=function(){for(var t=0;t<this._config.rows;t++)for(var e=0;e<this._config.columns;e++)this.grid[t][e]=this._tileFactory.next()},t.prototype._isValidPosition=function(t){return t.row>=0&&t.row<this._config.rows&&t.column>=0&&t.column<this._config.columns},t.prototype.applyGravity=function(){for(var t=0;t<this._config.columns;t++)for(var e=this._config.rows-1,i=this._config.rows-1;i>=0;i--)this.grid[i][t]&&(e!==i&&(this.grid[e][t]=this.grid[i][t],this.grid[i][t]=null),e--)},t.prototype.refillTop=function(){for(var t=0;t<this._config.columns;t++)for(var e=0;e<this._config.rows;e++)this.grid[e][t]||(this.grid[e][t]=this._tileFactory.next())},t}();i.GameBoard=r,cc._RF.pop()},{"./GameEvents":"GameEvents"}],GameController:[function(t,e,i){"use strict";cc._RF.push(e,"adc98hbUD9HPZL7X0r45uxe","GameController");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,a=s.property,u=t("./EventBus"),l=t("./InputLock"),p=t("./GameBoard"),h=t("./GameModel"),f=t("./BoardPresenter"),_=t("./UIService"),d=t("./TileFactory"),v=t("./ScoringStrategy"),m=t("./GameEvents"),y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boardView=null,e.scoreLabel=null,e.movesLabel=null,e.popup=null,e.popupMessage=null,e.rows=8,e.cols=8,e.moves=20,e.targetScore=500,e.colorCount=5,e.cellSize=72,e.animationDuration=.3,e.refillDelay=.05,e}return n(e,t),e.prototype.onLoad=function(){this._initializeServices(),this._setupEventListeners(),this._startGame()},e.prototype.onDestroy=function(){this._cleanupEventListeners()},e.prototype._initializeServices=function(){this._eventBus=u.gameEventBus,l.initializeInputManager(this._eventBus),this._gameConfig=this._createGameConfig(),this._board=this._createGameBoard(),this._gameModel=this._createGameModel(),this._boardPresenter=this._createBoardPresenter(),this._uiService=this._createUIService(),this._initializeBoardView()},e.prototype._createGameConfig=function(){return{board:{rows:this.rows,columns:this.cols,cellSize:this.cellSize,colorCount:this.colorCount,refillDelay:this.refillDelay},scoring:{baseScore:10,multiplier:2,targetScore:this.targetScore},ui:{moves:this.moves,animationDuration:this.animationDuration}}},e.prototype._createGameBoard=function(){var t=d.TileFactoryFactory.createRandomFactory(this._gameConfig.board);return new p.GameBoard(this._gameConfig.board,t,this._eventBus)},e.prototype._createGameModel=function(){var t=v.ScoringStrategyFactory.createDefault(this._gameConfig.scoring);return new h.GameModel(this._board,t,this._eventBus,this._gameConfig)},e.prototype._createBoardPresenter=function(){return new f.BoardPresenter},e.prototype._createUIService=function(){return new _.UIService(this._eventBus,this.scoreLabel,this.movesLabel,this.popup,this.popupMessage)},e.prototype._initializeBoardView=function(){this.boardView&&(this.boardView.initialize(this._eventBus,this._gameConfig.board),this._boardPresenter.initialize(this.boardView,this._board,this._eventBus,this._gameConfig.board,this._gameModel))},e.prototype._setupEventListeners=function(){this._eventBus.subscribe(m.GameEvents.BOARD_ANIMATION_STARTED,this._onAnimationStarted.bind(this)),this._eventBus.subscribe(m.GameEvents.BOARD_ANIMATION_COMPLETED,this._onAnimationCompleted.bind(this))},e.prototype._cleanupEventListeners=function(){this._eventBus.unsubscribe(m.GameEvents.BOARD_ANIMATION_STARTED,this._onAnimationStarted.bind(this)),this._eventBus.unsubscribe(m.GameEvents.BOARD_ANIMATION_COMPLETED,this._onAnimationCompleted.bind(this))},e.prototype._startGame=function(){this._board.initialize(),this.boardView?this.boardView.initializeFromSnapshot(this._gameModel.getBoardSnapshot()):console.error("BoardView is not assigned!"),this._eventBus.publish(m.GameEvents.GAME_STARTED,{})},e.prototype._onAnimationStarted=function(){l.getInputManager().lock()},e.prototype._onAnimationCompleted=function(){l.getInputManager().unlock()},e.prototype.onRestartButton=function(){this._gameModel.restart(),this.boardView&&this.boardView.initializeFromSnapshot(this._gameModel.getBoardSnapshot())},r([a(cc.Component)],e.prototype,"boardView",void 0),r([a(cc.Label)],e.prototype,"scoreLabel",void 0),r([a(cc.Label)],e.prototype,"movesLabel",void 0),r([a(cc.Node)],e.prototype,"popup",void 0),r([a(cc.Label)],e.prototype,"popupMessage",void 0),r([a(cc.Integer)],e.prototype,"rows",void 0),r([a(cc.Integer)],e.prototype,"cols",void 0),r([a(cc.Integer)],e.prototype,"moves",void 0),r([a(cc.Integer)],e.prototype,"targetScore",void 0),r([a(cc.Integer)],e.prototype,"colorCount",void 0),r([a(cc.Float)],e.prototype,"cellSize",void 0),r([a(cc.Float)],e.prototype,"animationDuration",void 0),r([a(cc.Float)],e.prototype,"refillDelay",void 0),r([c],e)}(cc.Component);i.default=y,cc._RF.pop()},{"./BoardPresenter":"BoardPresenter","./EventBus":"EventBus","./GameBoard":"GameBoard","./GameEvents":"GameEvents","./GameModel":"GameModel","./InputLock":"InputLock","./ScoringStrategy":"ScoringStrategy","./TileFactory":"TileFactory","./UIService":"UIService"}],GameEvents:[function(t,e,i){"use strict";cc._RF.push(e,"7de92ND7txDrKBh9lNR/y7C","GameEvents"),Object.defineProperty(i,"__esModule",{value:!0}),i.GameEvents=void 0;var o=function(){function t(){}return t.GAME_STARTED="game:started",t.GAME_ENDED="game:ended",t.GAME_WON="game:won",t.GAME_LOST="game:lost",t.GAME_RESTARTED="game:restarted",t.TILE_CLICKED="board:tile_clicked",t.TILES_MATCHED="board:tiles_matched",t.BOARD_UPDATED="board:updated",t.BOARD_ANIMATION_STARTED="board:animation_started",t.BOARD_ANIMATION_COMPLETED="board:animation_completed",t.SCORE_UPDATED="ui:score_updated",t.MOVES_UPDATED="ui:moves_updated",t.UI_UPDATED="ui:updated",t.INPUT_LOCKED="input:locked",t.INPUT_UNLOCKED="input:unlocked",t}();i.GameEvents=o,cc._RF.pop()},{}],GameModel:[function(t,e,i){"use strict";cc._RF.push(e,"9cdc4mFpDpAiK5ofNh8aO/+","GameModel");var o=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(n,r){function s(t){try{a(o.next(t))}catch(e){r(e)}}function c(t){try{a(o.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(s,c)}a((o=o.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(t){return function(e){return a([t,e])}}function a(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(c){r=[6,c],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0}),i.GameModel=void 0;var r=t("./GameEvents"),s=function(){function t(t,e,i,o){this._board=t,this._scoringStrategy=e,this._eventBus=i,this._config=o,this._score=0,this._movesLeft=0,this._isGameOver=!1,this._isWon=!1,this._movesLeft=this._config.ui.moves,this._setupEventListeners()}return t.prototype.onDestroy=function(){this._cleanupEventListeners()},t.prototype.getCurrentState=function(){return{score:this._score,movesLeft:this._movesLeft,isGameOver:this._isGameOver,isWon:this._isWon}},t.prototype.getBoardSnapshot=function(){return this._board.getSnapshot()},t.prototype.processTileClick=function(t){return o(this,void 0,Promise,function(){var e,i;return n(this,function(){return this._isGameOver||this._movesLeft<=0?[2,!1]:(e=this._board.findMatchingGroup(t)).length<2?[2,!1]:(i=this._scoringStrategy.getTotalScore(e.length),this._score+=i,this._movesLeft--,this._eventBus.publish(r.GameEvents.TILES_MATCHED,{positions:e,score:i}),this._updateGameState(),this._checkGameConditions(),[2,!0])})})},t.prototype.processTileMatch=function(t){return o(this,void 0,Promise,function(){var e;return n(this,function(){return this._isGameOver||this._movesLeft<=0?[2]:(e=this._scoringStrategy.getTotalScore(t.length),this._score+=e,this._movesLeft--,this._board.removeTiles(t),this._eventBus.publish(r.GameEvents.TILES_MATCHED,{positions:t,score:e}),this._updateGameState(),this._checkGameConditions(),[2])})})},t.prototype.restart=function(){this._score=0,this._movesLeft=this._config.ui.moves,this._isGameOver=!1,this._isWon=!1,this._board.initialize(),this._eventBus.publish(r.GameEvents.GAME_RESTARTED,{}),this._updateGameState()},t.prototype.isGameOver=function(){return this._isGameOver},t.prototype.isWon=function(){return this._isWon},t.prototype.hasValidMoves=function(){return this._board.hasValidMoves()},t.prototype.findMatchingGroup=function(t){return this._board.findMatchingGroup(t)},t.prototype._setupEventListeners=function(){this._eventBus.subscribe(r.GameEvents.BOARD_UPDATED,this._onBoardUpdated.bind(this)),this._eventBus.subscribe(r.GameEvents.GAME_STARTED,this._updateGameState.bind(this))},t.prototype._cleanupEventListeners=function(){this._eventBus.unsubscribe(r.GameEvents.BOARD_UPDATED,this._onBoardUpdated.bind(this)),this._eventBus.unsubscribe(r.GameEvents.GAME_STARTED,this._updateGameState.bind(this))},t.prototype._onBoardUpdated=function(){this._checkGameConditions()},t.prototype._checkGameConditions=function(){this._score>=this._config.scoring.targetScore?(this._isWon=!0,this._isGameOver=!0,this._eventBus.publish(r.GameEvents.GAME_WON,{})):(this._movesLeft<=0||!this._board.hasValidMoves())&&(this._isGameOver=!0,this._eventBus.publish(r.GameEvents.GAME_LOST,{}))},t.prototype._updateGameState=function(){this._eventBus.publish(r.GameEvents.SCORE_UPDATED,{score:this._score}),this._eventBus.publish(r.GameEvents.MOVES_UPDATED,{movesLeft:this._movesLeft});var t=this.getCurrentState();this._eventBus.publish(r.GameEvents.UI_UPDATED,{state:t})},t}();i.GameModel=s,cc._RF.pop()},{"./GameEvents":"GameEvents"}],IAnimationConfig:[function(t,e,i){"use strict";cc._RF.push(e,"e5f6g7h8-i9j0-1234-efgh-567890123456","IAnimationConfig"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IAnimationController:[function(t,e,i){"use strict";cc._RF.push(e,"5793dSh7ZZGTrJgzEG46ZWy","IAnimationController"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IBoardPresenter:[function(t,e,i){"use strict";cc._RF.push(e,"6ec4asXXh1CBrcm/+bgxHis","IBoardPresenter"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IBoardView:[function(t,e,i){"use strict";cc._RF.push(e,"87495rwy+BGk7xkGfF6TuiA","IBoardView"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IEventBus:[function(t,e,i){"use strict";cc._RF.push(e,"771cdgpaMFCKLs55P2qZF7d","IEventBus"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IGameBoard:[function(t,e,i){"use strict";cc._RF.push(e,"10157hT9P5IerG2IIAw0xDx","IGameBoard"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IGameConfig:[function(t,e,i){"use strict";cc._RF.push(e,"c3d4e5f6-g7h8-9012-cdef-345678901234","IGameConfig"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IGameEvent:[function(t,e,i){"use strict";cc._RF.push(e,"f6g7h8i9-j0k1-2345-fghi-678901234567","IGameEvent"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IGameModel:[function(t,e,i){"use strict";cc._RF.push(e,"40bc7wMFZ1A67d48QFVSnBx","IGameModel"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IGameService:[function(t,e,i){"use strict";cc._RF.push(e,"b9acaXl/2pGW6L+/yfXSByd","IGameService"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IGameState:[function(t,e,i){"use strict";cc._RF.push(e,"d4e5f6g7-h8i9-0123-defg-456789012345","IGameState"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IInputManager:[function(t,e,i){"use strict";cc._RF.push(e,"3c4ee57da9IZpILu3DT5e/P","IInputManager"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IPosition:[function(t,e,i){"use strict";cc._RF.push(e,"b2c3d4e5-f6g7-8901-bcde-f23456789012","IPosition"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IScoringStrategy:[function(t,e,i){"use strict";cc._RF.push(e,"c9cf5burb5HWo8FUqjrL0s4","IScoringStrategy"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],ITileFactory:[function(t,e,i){"use strict";cc._RF.push(e,"3864a7ecyxK87t8uD2Wt8Oz","ITileFactory"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],ITileView:[function(t,e,i){"use strict";cc._RF.push(e,"1455bci65VGOoNCDLU2L0N3","ITileView"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],ITile:[function(t,e,i){"use strict";cc._RF.push(e,"a1b2cPU5fZ4kKvN7xI0VniQ","ITile"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],IUIService:[function(t,e,i){"use strict";cc._RF.push(e,"c6409qgoj1GnpJRH7L2Kcz3","IUIService"),Object.defineProperty(i,"__esModule",{value:!0}),cc._RF.pop()},{}],InputLock:[function(t,e,i){"use strict";cc._RF.push(e,"82c19nb335EbJefEJlGIsqa","InputLock"),Object.defineProperty(i,"__esModule",{value:!0}),i.getInputManager=i.initializeInputManager=i.InputManager=void 0;var o=t("./GameEvents"),n=function(){function t(t){this._eventBus=t,this._locked=!1}return t.prototype.lock=function(){this._locked||(this._locked=!0,this._eventBus.publish(o.GameEvents.INPUT_LOCKED,{}))},t.prototype.unlock=function(){this._locked&&(this._locked=!1,this._eventBus.publish(o.GameEvents.INPUT_UNLOCKED,{}))},t.prototype.isLocked=function(){return this._locked},t}();i.InputManager=n;var r=null;i.initializeInputManager=function(t){r=new n(t)},i.getInputManager=function(){if(!r)throw new Error("InputManager not initialized. Call initializeInputManager first.");return r},cc._RF.pop()},{"./GameEvents":"GameEvents"}],ScoringStrategy:[function(t,e,i){"use strict";cc._RF.push(e,"e9daaHCR5dJ1rYMoAxaFGE1","ScoringStrategy"),Object.defineProperty(i,"__esModule",{value:!0}),i.ScoringStrategyFactory=i.ExponentialScoringStrategy=i.LinearScoringStrategy=i.DefaultScoringStrategy=void 0;var o=function(){function t(t){this._config=t}return t.prototype.calculateScore=function(t){return t<2?0:this._config.baseScore*(t-1)},t.prototype.calculateBonusScore=function(t){if(t<3)return 0;var e=Math.floor((t-2)/2);return this._config.baseScore*e*this._config.multiplier},t.prototype.getTotalScore=function(t){return this.calculateScore(t)+this.calculateBonusScore(t)},t}();i.DefaultScoringStrategy=o;var n=function(){function t(t){this._config=t}return t.prototype.calculateScore=function(t){return t<2?0:this._config.baseScore*t},t.prototype.calculateBonusScore=function(){return 0},t.prototype.getTotalScore=function(t){return this.calculateScore(t)},t}();i.LinearScoringStrategy=n;var r=function(){function t(t){this._config=t}return t.prototype.calculateScore=function(t){return t<2?0:this._config.baseScore*Math.pow(t,this._config.multiplier)},t.prototype.calculateBonusScore=function(){return 0},t.prototype.getTotalScore=function(t){return this.calculateScore(t)},t}();i.ExponentialScoringStrategy=r;var s=function(){function t(){}return t.createDefault=function(t){return new o(t)},t.createLinear=function(t){return new n(t)},t.createExponential=function(t){return new r(t)},t}();i.ScoringStrategyFactory=s,cc._RF.pop()},{}],TileFactory:[function(t,e,i){"use strict";cc._RF.push(e,"50a53Qo0ztFeK4mEmkcoW/U","TileFactory"),Object.defineProperty(i,"__esModule",{value:!0}),i.TileFactoryFactory=i.TileFactory=i.RandomTileGenerator=void 0;var o=function(){function t(t){if(this._colorCount=t,t<=0)throw new Error("Color count must be greater than 0")}return t.prototype.generateColorIndex=function(){return Math.floor(Math.random()*this._colorCount)},t}();i.RandomTileGenerator=o;var n=function(){function t(t,e){this._generator=t,this._config=e,this._nextId=1}return t.prototype.next=function(){var t=this._generator.generateColorIndex();return{id:this._nextId++,colorIndex:t}},t.prototype.createTile=function(){return this.next()},t.prototype.createTiles=function(t){if(t<=0)throw new Error("Count must be greater than 0");for(var e=[],i=0;i<t;i++)e.push(this.next());return e},t}();i.TileFactory=n;var r=function(){function t(){}return t.createRandomFactory=function(t){var e=new o(t.colorCount);return new n(e,t)},t}();i.TileFactoryFactory=r,cc._RF.pop()},{}],TileView:[function(t,e,i){"use strict";cc._RF.push(e,"573657nM0tIwJva4Nqfq/pX","TileView");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};Object.defineProperty(i,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,a=s.property,u=t("./GameEvents"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e.label=null,e.tileSprites=[],e.burnDuration=.18,e.dropDuration=.28,e.gridR=0,e.gridC=0,e._tileData=null,e}return n(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTileClicked,this)},e.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.TOUCH_END,this._onTileClicked,this)},e.prototype.initialize=function(t){this._eventBus=t},e.prototype._onTileClicked=function(){if(this._eventBus){var t={position:this.getPosition()};this._eventBus.publish(u.GameEvents.TILE_CLICKED,t)}},e.prototype.setData=function(t){this._tileData=t,t?(this.setActive(!0),this._updateVisuals(t)):this.setActive(!1)},e.prototype._updateVisuals=function(t){this.tileSprites&&this.tileSprites[t.colorIndex]?(this.sprite&&(this.sprite.spriteFrame=this.tileSprites[t.colorIndex]),this.label&&(this.label.string="")):this.label&&(this.label.string=String(t.colorIndex))},e.prototype.playBurnAnimation=function(){var t=this;return new Promise(function(e){var i=cc.fadeOut(t.burnDuration),o=cc.scaleTo(t.burnDuration,0),n=cc.sequence(cc.spawn(i,o),cc.callFunc(function(){t._resetVisualState(),e()}));t.node.runAction(n)})},e.prototype.playDropAnimation=function(t,e){var i=this;return void 0===e&&(e=0),new Promise(function(o){var n=cc.moveTo(i.dropDuration,t).easing(cc.easeCubicActionOut()),r=cc.sequence(cc.delayTime(e),n,cc.callFunc(function(){return o()}));i.node.runAction(r)})},e.prototype.getPosition=function(){return{row:this.gridR,column:this.gridC}},e.prototype.setPosition=function(t){this.gridR=t.row,this.gridC=t.column},e.prototype.setVisualPosition=function(t){this.node.setPosition(t)},e.prototype.isActive=function(){return this.node.active},e.prototype.setActive=function(t){this.node.active=t},e.prototype._resetVisualState=function(){this.node.active=!1,this.node.setScale(1),this.node.opacity=255},r([a(cc.Sprite)],e.prototype,"sprite",void 0),r([a(cc.Label)],e.prototype,"label",void 0),r([a([cc.SpriteFrame])],e.prototype,"tileSprites",void 0),r([a(cc.Float)],e.prototype,"burnDuration",void 0),r([a(cc.Float)],e.prototype,"dropDuration",void 0),r([c],e)}(cc.Component);i.default=l,cc._RF.pop()},{"./GameEvents":"GameEvents"}],UIService:[function(t,e,i){"use strict";cc._RF.push(e,"918323wIfpFSaN9zjflhrPv","UIService"),Object.defineProperty(i,"__esModule",{value:!0}),i.UIService=void 0;var o=t("./GameEvents"),n=function(){function t(t,e,i,o,n){this._eventBus=t,this._scoreLabel=e,this._movesLabel=i,this._popup=o,this._popupMessage=n,this._setupEventListeners()}return t.prototype.updateScore=function(t){this._scoreLabel&&(this._scoreLabel.string=t+" \u0418\u0417 500")},t.prototype.updateMoves=function(t){this._movesLabel&&(this._movesLabel.string=""+t)},t.prototype.updateGameState=function(t){this.updateScore(t.score),this.updateMoves(t.movesLeft)},t.prototype.showGameOverMessage=function(t){this._popup&&(this._popup.active=!0,this._popupMessage&&(this._popupMessage.string=t))},t.prototype.hideGameOverMessage=function(){this._popup&&(this._popup.active=!1)},t.prototype._setupEventListeners=function(){var t=this;this._eventBus.subscribe(o.GameEvents.SCORE_UPDATED,function(e){t.updateScore(e.data.score)}),this._eventBus.subscribe(o.GameEvents.MOVES_UPDATED,function(e){t.updateMoves(e.data.movesLeft)}),this._eventBus.subscribe(o.GameEvents.UI_UPDATED,function(e){t.updateGameState(e.data.state)}),this._eventBus.subscribe(o.GameEvents.GAME_WON,function(){t.showGameOverMessage("\u041f\u041e\u0411\u0415\u0414\u0410!")}),this._eventBus.subscribe(o.GameEvents.GAME_LOST,function(){t.showGameOverMessage("\u041f\u0420\u041e\u0418\u0413\u0420\u042b\u0428")}),this._eventBus.subscribe(o.GameEvents.GAME_RESTARTED,function(){t.hideGameOverMessage()})},t}();i.UIService=n,cc._RF.pop()},{"./GameEvents":"GameEvents"}]},{},["BoardPresenter","BoardView","EventBus","GameBoard","GameController","GameEvents","GameModel","InputLock","ScoringStrategy","TileFactory","TileView","UIService","IAnimationConfig","IAnimationController","IBoardPresenter","IBoardView","IEventBus","IGameBoard","IGameConfig","IGameEvent","IGameModel","IGameService","IGameState","IInputManager","IPosition","IScoringStrategy","ITile","ITileFactory","ITileView","IUIService"]);